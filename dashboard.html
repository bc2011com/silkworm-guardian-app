<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Sarabun", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #e8f5e9;
      min-height: 100vh;
      color: #1b5e20;
    }

    .app-wrapper {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #e8f5e9;
      display: flex;
      flex-direction: column;
    }

    /* ---------- HEADER ‡∏ö‡∏ô‡∏™‡∏∏‡∏î ---------- */
    .top-header {
      background: linear-gradient(180deg, #2e7d32, #1b5e20);
      padding: 18px 18px 14px;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .top-header-icon {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .top-header-text h1 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .top-header-text p {
      font-size: 13px;
      opacity: 0.9;
    }

    /* ---------- ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ + ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å ---------- */
    .today-strip {
      background: #f1f8e9;
      border-bottom: 1px solid #c8e6c9;
      padding: 10px 14px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .today-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      color: #1b5e20;
      font-size: 13px;
    }

    .today-main span.label {
      font-weight: 600;
    }

    .today-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-size: 12px;
      color: #33691e;
    }

    .logout-btn {
      border: none;
      background: #ef5350;
      color: white;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.18);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .logout-btn:hover {
      background: #e53935;
    }

    /* ---------- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å ---------- */
    .content {
      flex: 1;
      padding: 16px 14px 80px;
    }

    .info-card {
      background: #f9fff9;
      border-radius: 14px;
      padding: 14px 16px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      margin-bottom: 16px;
    }

    .info-card h2 {
      font-size: 16px;
      margin-bottom: 4px;
    }

    .info-card p {
      font-size: 13px;
      color: #33691e;
      margin-bottom: 2px;
    }

    .info-card span.value {
      font-weight: 600;
    }

    /* ---------- GRID ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å ---------- */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 14px;
    }

    .card-button {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 10px 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      text-decoration: none;
      color: #1b5e20;
      min-height: 110px;
    }

    .card-button .icon-circle {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: #e8f5e9;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      font-size: 24px;
    }

    .card-button h3 {
      font-size: 14px;
      text-align: center;
      margin-bottom: 2px;
    }

    .card-button p {
      text-align: center;
      font-size: 12px;
      color: #558b2f;
    }

    .card-button.orange {
      background: #fff3e0;
    }

    .card-button.red {
      background: #ffebee;
    }

    .card-button.blue {
      background: #e3f2fd;
    }

    .card-button.green {
      background: #e8f5e9;
    }

    /* ---------- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á ---------- */
    .voice-box {
      margin-top: 4px;
      background: #ffffff;
      border-radius: 16px;
      padding: 12px 14px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      font-size: 12px;
      color: #33691e;
    }

    .voice-box-title {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 12px;
    }

    .voice-box ul {
      list-style: none;
      padding-left: 0;
    }

    .voice-box li {
      margin-bottom: 3px;
    }

    .voice-key {
      color: #1b5e20;
      font-weight: 500;
    }

    /* ---------- ‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ---------- */
    .bottom-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-top: 1px solid #c8e6c9;
      padding: 6px 10px 8px;
      display: flex;
      justify-content: space-around;
      z-index: 20;
    }

    .bottom-nav button,
    .bottom-nav a {
      background: none;
      border: none;
      text-align: center;
      font-size: 11px;
      color: #558b2f;
      text-decoration: none;
    }

    .bottom-nav .nav-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #e8f5e9;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 2px;
      font-size: 16px;
      color: #2e7d32;
    }

    .bottom-nav .active .nav-icon {
      background: #2e7d32;
      color: #ffffff;
    }

    .bottom-nav .active span {
      font-weight: 600;
      color: #2e7d32;
    }

    @media (max-width: 360px) {
      .cards-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-wrapper">

    <!-- HEADER -->
    <header class="top-header">
      <div class="top-header-icon">üßµ</div>
      <div class="top-header-text">
        <h1>‡∏≠‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏≤‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
        <p>‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÑ‡∏ó‡∏¢</p>
      </div>
    </header>

    <!-- ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ + ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö -->
    <section class="today-strip">
      <div class="today-main">
        <span class="label" id="today-date">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Ä¶</span>
        <span id="current-instar-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡πÑ‡∏´‡∏°‚Ä¶</span>
      </div>
      <div class="today-meta">
        <span>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£: <strong id="farmer-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</strong></span>
        <span>‡∏ü‡∏≤‡∏£‡πå‡∏°/‡∏Å‡∏•‡∏∏‡πà‡∏°: <strong id="farm-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</strong></span>
        <button id="logout-btn" class="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </section>

    <!-- CONTENT ‡∏´‡∏•‡∏±‡∏Å -->
    <main class="content">

      <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ -->
      <section class="info-card">
        <h2>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
        <p>‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á: <span class="value" id="batch-name">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</span></p>
        <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="value" id="batch-status">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°</span></p>
      </section>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤) -->
      <section class="cards-grid">

        <!-- ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û -->
        <a href="#" class="card-button blue">
          <div class="icon-circle">üì∑</div>
          <h3>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</h3>
          <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏´‡∏ô‡∏≠‡∏ô‡πÑ‡∏´‡∏° / ‡πÇ‡∏£‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
        </a>

        <!-- ‡πÇ‡∏ó‡∏£‡∏ñ‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏≥ AI -->
        <a href="#" class="card-button green">
          <div class="icon-circle">üìû</div>
          <h3>‡πÇ‡∏ó‡∏£‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÑ‡∏´‡∏°‡∏Ñ‡∏≥</h3>
          <p>‡∏ñ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°</p>
        </a>

        <!-- ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 27 ‡∏ß‡∏±‡∏ô) -->
        <a href="feeding_plan.html" class="card-button orange">
          <div class="icon-circle">üçΩÔ∏è</div>
          <h3>‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
          <p>‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏´‡∏° 27 ‡∏ß‡∏±‡∏ô</p>
        </a>

        <!-- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô -->
        <a href="#" class="card-button">
          <div class="icon-circle">üå°Ô∏è</div>
          <h3>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‚Äì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</h3>
          <p>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏†‡∏≤‡∏û‡πÇ‡∏£‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</p>
        </a>

        <!-- ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á -->
        <a href="#" class="card-button">
          <div class="icon-circle">üßπ</div>
          <h3>‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î</h3>
          <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
        </a>

        <!-- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏Ñ / ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÑ‡∏´‡∏° -->
        <a href="#" class="card-button red">
          <div class="icon-circle">ü¶†</div>
          <h3>‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÇ‡∏£‡∏Ñ‡πÑ‡∏´‡∏°</h3>
          <p>‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÑ‡∏´‡∏°</p>
        </a>

        <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
        <a href="#" class="card-button">
          <div class="icon-circle">üìä</div>
          <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
          <p>‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î</p>
        </a>

        <!-- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô -->
        <a href="mulberry_recommendation.html" class="card-button green">
          <div class="icon-circle">üåø</div>
          <h3>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô</h3>
          <p>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°</p>
        </a>

      </section>

      <!-- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
      <section class="voice-box">
        <div class="voice-box-title">
          <span>üîë ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>
        </div>
        <ul>
          <li><span class="voice-key">‚Äú‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏ô‡∏≠‡∏ô‡πÑ‡∏´‡∏°‚Äù</span> ‚Äì ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</li>
          <li><span class="voice-key">‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‚Äù</span> ‚Äì ‡∏î‡∏π‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</li>
          <li><span class="voice-key">‚Äú‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‚Äù</span> ‚Äì ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô</li>
          <li><span class="voice-key">‚Äú‡∏î‡∏π‡πÅ‡∏ú‡∏ô 27 ‡∏ß‡∏±‡∏ô‚Äù</span> ‚Äì ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 27 ‡∏ß‡∏±‡∏ô</li>
        </ul>
      </section>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
      <button class="active">
        <div class="nav-icon">üè†</div>
        <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
      </button>
      <a href="#" class="">
        <div class="nav-icon">üìà</div>
        <span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
      </a>
      <a href="#" class="">
        <div class="nav-icon">‚öôÔ∏è</div>
        <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
      </a>
    </nav>

  </div>

  <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Supabase + Auth (‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß) -->
  <script type="module">
    import { supabase } from "./supabase.js";
    import { requireAuth } from "./auth-guard.js";

    // 1) ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô
    const { user } = await requireAuth();

    // 2) ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ
    const todayDateEl = document.getElementById("today-date");
    const today = new Date();
    const thaiMonths = [
      "‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.",
      "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."
    ];
    const d = today.getDate();
    const m = thaiMonths[today.getMonth()];
    const y = today.getFullYear() + 543;
    todayDateEl.textContent = `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ${d} ${m} ${y}`;

    // 3) ‡∏î‡∏∂‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á profiles
    const farmerNameEl = document.getElementById("farmer-name");
    const farmNameEl = document.getElementById("farm-name");

    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("full_name, farm_name")
      .eq("user_id", user.id)
      .single();

    if (profileError) {
      console.error("‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", profileError);
      farmerNameEl.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      farmNameEl.textContent = "-";
    } else if (profile) {
      farmerNameEl.textContent = profile.full_name || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
      farmNameEl.textContent = profile.farm_name || "-";
    }

    // 4) (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‡∏•‡∏≠‡∏á‡∏´‡∏≤ batch ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    const batchNameEl = document.getElementById("batch-name");
    const batchStatusEl = document.getElementById("batch-status");
    const instarTextEl = document.getElementById("current-instar-text");

    try {
      const { data: activeBatch, error: batchError } = await supabase
        .from("silkworm_batches")
        .select("id, batch_name, is_active, current_instar, current_day")
        .eq("user_id", user.id)
        .eq("is_active", true)
        .maybeSingle();

      if (batchError) {
        console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", batchError);
      }

      if (!activeBatch) {
        batchNameEl.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á";
        batchStatusEl.textContent = "‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        instarTextEl.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö";
      } else {
        batchNameEl.textContent = activeBatch.batch_name || "‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô";
        batchStatusEl.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏ß‡∏±‡∏¢‡∏ó‡∏µ‡πà ${activeBatch.current_instar || "-"} (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${activeBatch.current_day || "-"})`;
        instarTextEl.textContent = `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏ß‡∏±‡∏¢‡∏ó‡∏µ‡πà ${activeBatch.current_instar || "-"} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${activeBatch.current_day || "-"} ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ`;
      }
    } catch (e) {
      console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:", e);
    }

    // 5) ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    const logoutBtn = document.getElementById("logout-btn");
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
