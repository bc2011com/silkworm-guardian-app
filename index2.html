<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏≠‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏≤‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‚Äì Prototype</title>

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', Arial, sans-serif;
      background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
      min-height: 100vh;
      font-size: 22px;
      line-height: 1.6;
      color: #234530;
    }

    .app-shell {
      max-width: 1200px;
      margin: 24px auto 40px;
      padding: 16px;
    }

    /* Header */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      background: #66bb6a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 26px;
      box-shadow: 0 6px 14px rgba(76, 175, 80, 0.25);
    }

    .brand-text-title {
      font-size: 26px;
      font-weight: 700;
      color: #1b5e20;
    }

    .brand-text-subtitle {
      font-size: 16px;
      color: #558b2f;
    }

    .header-pill {
      padding: 8px 18px;
      border-radius: 999px;
      background: #c8e6c9;
      font-size: 16px;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
      box-shadow: 0 3px 6px rgba(56, 142, 60, 0.2);
    }

    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏Å */
    .card {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(46, 125, 50, 0.18);
      padding: 20px 24px;
      margin-top: 16px;
    }

    .card-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    .card-title {
      font-size: 22px;
      font-weight: 700;
      color: #1b5e20;
    }

    .card-subtitle {
      font-size: 16px;
      color: #78909c;
    }

    /* layout login/register */
    .grid-2 {
      display: grid;
      grid-template-columns: 1.1fr 1.2fr;
      gap: 24px;
    }

    @media (max-width: 900px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #1b5e20;
      margin-bottom: 6px;
    }

    .section-hint {
      font-size: 15px;
      color: #607d8b;
      margin-bottom: 14px;
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 16px;
      margin-bottom: 4px;
      color: #33691e;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #c5e1a5;
      background: #f9fff7;
      font-size: 18px;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input:focus {
      border-color: #66bb6a;
      box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.3);
      background: #ffffff;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 22px;
      border-radius: 999px;
      font-size: 18px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .btn-primary {
      background: #43a047;
      color: #fff;
      box-shadow: 0 8px 18px rgba(56, 142, 60, 0.5);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(56, 142, 60, 0.6);
      background: #388e3c;
    }

    .btn-outline {
      background: #ffffff;
      color: #2e7d32;
      border: 1px solid #81c784;
      box-shadow: 0 4px 10px rgba(76, 175, 80, 0.25);
    }

    .btn-outline:hover {
      background: #e8f5e9;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: #e53935;
      color: #fff;
      box-shadow: 0 8px 18px rgba(211, 47, 47, 0.45);
    }

    .btn-danger:hover {
      background: #c62828;
    }

    .btn-sm {
      font-size: 15px;
      padding: 6px 14px;
    }

    .text-right {
      text-align: right;
    }

    .badge-user {
      padding: 6px 14px;
      border-radius: 999px;
      background: #e8f5e9;
      border: 1px solid #c5e1a5;
      font-size: 15px;
      color: #2e7d32;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-bar {
      margin-top: 14px;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-info {
      background: #fff8e1;
      color: #8d6e63;
      border: 1px solid #ffe082;
    }

    .status-success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c5e1a5;
    }

    .status-error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }

    .status-pill {
      font-weight: 700;
    }

    /* MAIN MENU ‚Äì ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà */
    #main-menu-section {
      margin-top: 16px;
    }

    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .menu-title {
      font-size: 24px;
      font-weight: 700;
      color: #1b5e20;
    }

    .menu-subtitle {
      font-size: 16px;
      color: #607d8b;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-top: 6px;
    }

    .menu-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 16px 18px;
      border: 1px solid #c5e1a5;
      box-shadow: 0 10px 22px rgba(85, 139, 47, 0.25);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .menu-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 30px rgba(56, 142, 60, 0.4);
      background: #f1f8e9;
    }

    .menu-icon {
      font-size: 30px;
    }

    .menu-text-main {
      font-size: 22px;
      font-weight: 700;
      color: #1b5e20;
    }

    .menu-text-sub {
      font-size: 16px;
      color: #607d8b;
    }

    /* DASHBOARD */
    #dashboard-section {
      margin-top: 16px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 2.2fr 1.8fr;
      gap: 20px;
      margin-top: 8px;
    }

    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 14px;
      margin-bottom: 16px;
    }

    .stat-card {
      background: #f9fff7;
      border-radius: 16px;
      padding: 10px 14px;
      border: 1px solid #c5e1a5;
    }

    .stat-label {
      font-size: 16px;
      color: #607d8b;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #1b5e20;
    }

    .stat-unit {
      font-size: 15px;
      color: #78909c;
    }

    .table-wrapper {
      margin-top: 6px;
      border-radius: 16px;
      border: 1px solid #c5e1a5;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 18px;
    }

    thead {
      background: #e8f5e9;
    }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      text-align: left;
      font-weight: 600;
      color: #33691e;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    .empty-row {
      text-align: center;
      color: #90a4ae;
      font-size: 16px;
      padding: 14px 10px;
    }

    .chart-box {
      border-radius: 16px;
      border: 1px solid #c5e1a5;
      padding: 12px;
      background: #f9fff7;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .chart-title {
      font-size: 18px;
      font-weight: 700;
      color: #1b5e20;
    }

    .chart-subtitle {
      font-size: 14px;
      color: #78909c;
    }

    canvas {
      flex: 1;
    }

    /* visibility helpers */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <!-- Header -->
  <header class="app-header">
    <div class="brand">
      <div class="brand-logo">‡πÑ‡∏´‡∏°</div>
      <div>
        <div class="brand-text-title">‡∏≠‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏≤‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
        <div class="brand-text-subtitle">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£ ‚Äì Prototype
        </div>
      </div>
    </div>
    <div class="header-pill">Supabase + Chart.js ¬∑ ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô MVP</div>
  </header>

  <!-- 1) AUTH SECTION -->
  <section id="auth-section" class="card">
    <div class="card-header-row">
      <div>
        <div class="card-title">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div class="card-subtitle">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£: ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
      </div>
    </div>

    <div class="grid-2">
      <!-- Login -->
      <div>
        <div class="section-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div class="section-hint">
          ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        </div>

        <div class="form-group">
          <label for="login-email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
          <input id="login-email" type="email" placeholder="your@email.com">
        </div>
        <div class="form-group">
          <label for="login-password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input id="login-password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        </div>
        <button id="login-btn" class="btn btn-primary">
          ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </div>

      <!-- Register -->
      <div>
        <div class="section-title">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</div>
        <div class="section-hint">
          ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </div>

        <div class="form-group">
          <label for="reg-fullname">‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•</label>
          <input id="reg-fullname" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•">
        </div>

        <div class="form-group">
          <label for="reg-username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)</label>
          <input id="reg-username" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô farmer surin">
        </div>

        <div class="form-group">
          <label for="reg-farm-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏≤‡∏£‡πå‡∏° / ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</label>
          <input id="reg-farm-name" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÑ‡∏´‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏ï‡∏≤‡πÇ‡∏õ">
        </div>

        <div class="form-group">
          <label for="reg-email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö)</label>
          <input id="reg-email" type="email" placeholder="your@email.com">
        </div>

        <div class="form-group">
          <label for="reg-password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input id="reg-password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
        </div>

        <div class="text-right">
          <button id="register-btn" class="btn btn-outline">
            ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
          </button>
        </div>
      </div>
    </div>

    <div id="auth-message" class="status-bar status-info">
      ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
    </div>
  </section>

  <!-- 2) MAIN MENU SECTION -->
  <section id="main-menu-section" class="card hidden">
    <div class="menu-header">
      <div>
        <div class="menu-title">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏≤‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
        <div class="menu-subtitle">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£
        </div>
      </div>
      <div class="text-right">
        <div class="badge-user" id="menu-user-badge">
          ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: -
        </div>
      </div>
    </div>

    <div class="menu-grid">
      <div class="menu-card" id="menu-to-dashboard">
        <div class="menu-icon">üìä</div>
        <div class="menu-text-main">‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏´‡∏°</div>
        <div class="menu-text-sub">
          ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡πÑ‡∏Ç‡πà ‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </div>
      </div>

      <div class="menu-card" id="menu-add-cycle">
        <div class="menu-icon">üêõ</div>
        <div class="menu-text-main">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°</div>
        <div class="menu-text-sub">
          ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
        </div>
      </div>

      <div class="menu-card" id="menu-feeding-log">
        <div class="menu-icon">üçÉ</div>
        <div class="menu-text-main">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏´‡∏°</div>
        <div class="menu-text-sub">
          ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á feeding_logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô (‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
        </div>
      </div>

      <div class="menu-card" id="menu-guide">
        <div class="menu-icon">üìö</div>
        <div class="menu-text-main">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° 52 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
        <div class="menu-text-sub">
          ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏£‡∏°‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏° ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏≤‡πÑ‡∏´‡∏° (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
        </div>
      </div>
    </div>

    <div class="status-bar status-success" id="main-menu-message">
      ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    </div>

    <div style="margin-top: 12px; text-align: right;">
      <button id="logout-btn-menu" class="btn btn-danger btn-sm">
        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>
  </section>

  <!-- 3) DASHBOARD SECTION -->
  <section id="dashboard-section" class="card hidden">
    <div class="card-header-row">
      <div>
        <div class="card-title">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏´‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div>
        <div class="card-subtitle">
          ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Supabase ‚Äì ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü
        </div>
      </div>
      <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
        <button id="back-to-menu-btn" class="btn btn-outline btn-sm">
          ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
        </button>
        <div class="badge-user" id="dashboard-user-badge">
          ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: -
        </div>
        <button id="logout-btn-dashboard" class="btn btn-danger btn-sm">
          ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </div>
    </div>

    <div id="dashboard-status" class="status-bar status-info">
      ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    </div>

    <div class="dashboard-grid">
      <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
      <div>
        <div class="stat-grid">
          <div class="stat-card">
            <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div class="stat-value" id="stat-total-cycles">0</div>
            <div class="stat-unit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á silkworm_cycles</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡πÑ‡∏Ç‡πà‡∏£‡∏ß‡∏°</div>
            <div class="stat-value" id="stat-total-eggs">0</div>
            <div class="stat-unit">‡πÅ‡∏ú‡πà‡∏ô‡πÑ‡∏Ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å ‡πÜ ‡∏£‡∏≠‡∏ö</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡∏£‡∏ß‡∏°</div>
            <div class="stat-value" id="stat-total-cocoon">0.00</div>
            <div class="stat-unit">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏°‡∏£‡∏ß‡∏°</div>
            <div class="stat-value" id="stat-total-silk">0.00</div>
            <div class="stat-unit">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ß‡πÑ‡∏î‡πâ</div>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
            <tr>
              <th>‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</th>
              <th>‡πÄ‡∏£‡∏¥‡πà‡∏°‚Äì‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
              <th>‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏´‡∏°</th>
              <th>‡πÅ‡∏ú‡πà‡∏ô‡πÑ‡∏Ç‡πà</th>
              <th>‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏° (‡∏Å‡∏Å.)</th>
              <th>‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏° (‡∏Å‡∏Å.)</th>
              <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
            </tr>
            </thead>
            <tbody id="cycles-table-body">
            <tr>
              <td class="empty-row" colspan="7">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡πà‡∏≤‡∏ô Supabase ‡∏´‡∏£‡∏∑‡∏≠‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ‡∏Å‡∏£‡∏≤‡∏ü -->
      <div>
        <div class="chart-box">
          <div class="chart-header">
            <div class="chart-title">‡∏Å‡∏£‡∏≤‡∏ü‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</div>
            <div class="chart-subtitle">Timeline &amp; ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏´‡∏°</div>
          </div>
          <canvas id="silk-chart"></canvas>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // ==============================
  // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase
  // ==============================
  const SUPABASE_URL = 'https://dpgnqrxanxyxhibkfspx.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwZ25xcnhhbnh5eGhpYmtmc3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjU5NjksImV4cCI6MjA3ODYwMTk2OX0.CTWYu4ZxS_gW6G4r0zGNNj6gVkNE6jSWmcGoXc6GaxI';

  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á element ‡∏´‡∏•‡∏±‡∏Å
  const authSection = document.getElementById('auth-section');
  const mainMenuSection = document.getElementById('main-menu-section');
  const dashboardSection = document.getElementById('dashboard-section');

  const authMessageEl = document.getElementById('auth-message');
  const mainMenuMessageEl = document.getElementById('main-menu-message');
  const dashboardStatusEl = document.getElementById('dashboard-status');

  const loginBtn = document.getElementById('login-btn');
  const registerBtn = document.getElementById('register-btn');

  const logoutMenuBtn = document.getElementById('logout-btn-menu');
  const logoutDashBtn = document.getElementById('logout-btn-dashboard');
  const backToMenuBtn = document.getElementById('back-to-menu-btn');

  const menuUserBadge = document.getElementById('menu-user-badge');
  const dashboardUserBadge = document.getElementById('dashboard-user-badge');

  const menuToDashboard = document.getElementById('menu-to-dashboard');
  const menuAddCycle = document.getElementById('menu-add-cycle');
  const menuFeedingLog = document.getElementById('menu-feeding-log');
  const menuGuide = document.getElementById('menu-guide');

  let currentUser = null;
  let silkChartInstance = null;

  function showAuth() {
    authSection.classList.remove('hidden');
    mainMenuSection.classList.add('hidden');
    dashboardSection.classList.add('hidden');
  }

  function showMainMenu() {
    authSection.classList.add('hidden');
    mainMenuSection.classList.remove('hidden');
    dashboardSection.classList.add('hidden');
  }

  function showDashboard() {
    authSection.classList.add('hidden');
    mainMenuSection.classList.add('hidden');
    dashboardSection.classList.remove('hidden');
    loadDashboardData();
  }

  function setAuthMessage(type, text) {
    authMessageEl.textContent = text;
    authMessageEl.classList.remove('status-info', 'status-success', 'status-error');
    authMessageEl.classList.add(type === 'error' ? 'status-error'
      : type === 'success' ? 'status-success' : 'status-info');
  }

  function setDashboardStatus(type, text) {
    dashboardStatusEl.textContent = text;
    dashboardStatusEl.classList.remove('status-info', 'status-success', 'status-error');
    dashboardStatusEl.classList.add(type === 'error' ? 'status-error'
      : type === 'success' ? 'status-success' : 'status-info');
  }

  function updateUserBadges(email) {
    menuUserBadge.textContent = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + email;
    dashboardUserBadge.textContent = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + email;
  }

  // ==============================
  // 2. ‡∏ï‡∏£‡∏ß‡∏à session ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
  // ==============================
  document.addEventListener('DOMContentLoaded', async () => {
    const { data, error } = await supabaseClient.auth.getSession();
    if (error) {
      console.error(error);
      showAuth();
      return;
    }
    if (data.session && data.session.user) {
      currentUser = data.session.user;
      updateUserBadges(currentUser.email);
      showMainMenu();
      setDashboardStatus('info',
        '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
    } else {
      showAuth();
    }
  });

  // ==============================
  // 3. ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
  // ==============================
  registerBtn.addEventListener('click', async () => {
    const fullName = document.getElementById('reg-fullname').value.trim();
    const username = document.getElementById('reg-username').value.trim();
    const farmName = document.getElementById('reg-farm-name').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const password = document.getElementById('reg-password').value;

    if (!fullName || !username || !farmName || !email || !password) {
      setAuthMessage('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô');
      return;
    }

    if (password.length < 6) {
      setAuthMessage('error', '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
      return;
    }

    setAuthMessage('info', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà...');

    const { data, error } = await supabaseClient.auth.signUp({
      email,
      password
    });

    if (error) {
      console.error(error);
      setAuthMessage('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ: ' + error.message);
      return;
    }

    const user = data.user;
    if (!user) {
      setAuthMessage('error',
        '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Supabase ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      return;
    }

    const { error: profileError } = await supabaseClient
      .from('profiles')
      .insert({
        user_id: user.id,
        full_name: fullName,
        username: username,
        farm_name: farmName
      });

    if (profileError) {
      console.error(profileError);
      setAuthMessage('error',
        '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ: ' + profileError.message);
      return;
    }

    currentUser = user;
    updateUserBadges(user.email);
    setAuthMessage('success',
      '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ');
  });

  // ==============================
  // 4. ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
  // ==============================
  loginBtn.addEventListener('click', async () => {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;

    if (!email || !password) {
      setAuthMessage('error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
      return;
    }

    setAuthMessage('info', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');

    const { data, error } = await supabaseClient.auth.signInWithPassword({
      email,
      password
    });

    if (error) {
      console.error(error);
      setAuthMessage('error', '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
      return;
    }

    currentUser = data.user;
    updateUserBadges(currentUser.email);
    setAuthMessage('success', '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å...');
    showMainMenu();
    setDashboardStatus('info',
      '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
  });

  // ==============================
  // 5. Logout
  // ==============================
  async function handleLogout() {
    await supabaseClient.auth.signOut();
    currentUser = null;
    setAuthMessage('info', '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    showAuth();
  }

  logoutMenuBtn.addEventListener('click', handleLogout);
  logoutDashBtn.addEventListener('click', handleLogout);

  // ==============================
  // 6. ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
  // ==============================
  menuToDashboard.addEventListener('click', () => {
    showDashboard();
  });

  backToMenuBtn.addEventListener('click', () => {
    showMainMenu();
  });

  const showComingSoon = (message) => {
    mainMenuMessageEl.textContent = message + ' (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)';
    mainMenuMessageEl.classList.remove('status-info', 'status-error');
    mainMenuMessageEl.classList.add('status-success');
  };

  menuAddCycle.addEventListener('click', () => {
    showComingSoon('‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°');
  });

  menuFeedingLog.addEventListener('click', () => {
    showComingSoon('‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏´‡∏° (feeding_logs)');
  });

  menuGuide.addEventListener('click', () => {
    showComingSoon('‡πÄ‡∏°‡∏ô‡∏π‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° 52 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå');
  });

  // ==============================
  // 7. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard ‡∏à‡∏≤‡∏Å Supabase
  // ==============================
  async function loadDashboardData() {
    if (!currentUser) return;

    const { data, error } = await supabaseClient
      .from('silkworm_cycles')
      .select('*')
      .eq('user_id', currentUser.id)
      .order('start_date', { ascending: true });

    if (error) {
      console.error(error);
      setDashboardStatus('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÑ‡∏î‡πâ: ' + error.message);
      return;
    }

    const cycles = data || [];

    const totalCycles = cycles.length;
    const totalEggs = cycles.reduce((sum, c) => sum + (c.egg_tray_count || 0), 0);
    const totalCocoon = cycles.reduce((sum, c) => sum + Number(c.cocoon_weight_kg || 0), 0);
    const totalSilk = cycles.reduce((sum, c) => sum + Number(c.raw_silk_weight_kg || 0), 0);

    document.getElementById('stat-total-cycles').textContent = totalCycles;
    document.getElementById('stat-total-eggs').textContent = totalEggs;
    document.getElementById('stat-total-cocoon').textContent = totalCocoon.toFixed(2);
    document.getElementById('stat-total-silk').textContent = totalSilk.toFixed(2);

    const tbody = document.getElementById('cycles-table-body');
    tbody.innerHTML = '';

    if (cycles.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 7;
      td.className = 'empty-row';
      td.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡πà‡∏≤‡∏ô Supabase ‡∏´‡∏£‡∏∑‡∏≠‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï';
      tr.appendChild(td);
      tbody.appendChild(tr);

      setDashboardStatus('info',
        '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
    } else {
      for (const cycle of cycles) {
        const tr = document.createElement('tr');

        const periodText = (cycle.start_date || '') +
          (cycle.end_date ? ' ‚Äì ' + cycle.end_date : '');

        const cells = [
          cycle.cycle_name || '-',
          periodText || '-',
          cycle.silkworm_breed || '-',
          cycle.egg_tray_count ?? '-',
          cycle.cocoon_weight_kg ?? '-',
          cycle.raw_silk_weight_kg ?? '-',
          cycle.note || '-'
        ];

        for (const value of cells) {
          const td = document.createElement('td');
          td.textContent = value;
          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      }

      setDashboardStatus('success',
        '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á');
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
    const labels = cycles.map(c => c.cycle_name || '‡∏£‡∏≠‡∏ö');
    const cocoonData = cycles.map(c => Number(c.cocoon_weight_kg || 0));
    const silkData = cycles.map(c => Number(c.raw_silk_weight_kg || 0));

    const ctx = document.getElementById('silk-chart').getContext('2d');
    if (silkChartInstance) {
      silkChartInstance.destroy();
    }

    silkChartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: '‡∏£‡∏±‡∏á‡πÑ‡∏´‡∏° (‡∏Å‡∏Å.)',
            data: cocoonData
          },
          {
            label: '‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏° (‡∏Å‡∏Å.)',
            data: silkData
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              font: {
                family: 'Sarabun',
                size: 14
              }
            }
          }
        },
        scales: {
          x: {
            ticks: {
              font: {
                family: 'Sarabun',
                size: 13
              }
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              font: {
                family: 'Sarabun',
                size: 13
              }
            }
          }
        }
      }
    });
  }
</script>
</body>
</html>


